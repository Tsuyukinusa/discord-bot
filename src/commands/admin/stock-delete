import { SlashCommandBuilder, EmbedBuilder, PermissionFlagsBits } from "discord.js";
import { readGuildDB, writeGuildDB } from "../../utils/file.js";

export default {
    data: new SlashCommandBuilder()
        .setName("stock-delete")
        .setDescription("æ ªå¼ä¼šç¤¾ã‚’å‰Šé™¤ã—ã¾ã™ï¼ˆç®¡ç†è€…å°‚ç”¨ï¼‰")
        .setDefaultMemberPermissions(PermissionFlagsBits.Administrator)
        .addStringOption(o =>
            o.setName("id")
                .setDescription("ä¼šç¤¾ID")
                .setRequired(true)
        ),

    async execute(interaction) {
        const guildId = interaction.guild.id;
        const id = interaction.options.getString("id");

        const db = await readGuildDB();
        const stock = db[guildId]?.stocks?.[id];

        if (!stock) {
            return interaction.reply({
                content: "âŒ ãã®ä¼šç¤¾ã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚",
                ephemeral: true
            });
        }

        delete db[guildId].stocks[id];
        await writeGuildDB(db);

        const embed = new EmbedBuilder()
            .setColor("#ff4d4d")
            .setTitle("ğŸ—‘ï¸ æ ªå¼ä¼šç¤¾ å‰Šé™¤å®Œäº†")
            .addFields(
                { name: "ID", value: id },
                { name: "ä¼šç¤¾å", value: stock.name }
            );

        return interaction.reply({
            embeds: [embed],
            ephemeral: true
        });
    }
};
